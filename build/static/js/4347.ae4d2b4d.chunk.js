"use strict";(self.webpackChunkpaymaster_crm=self.webpackChunkpaymaster_crm||[]).push([[4347],{4347:(e,a,t)=>{t.r(a),t.d(a,{default:()=>f});var s=t(9950),r=t(2436),n=t(5731),i=t(2577),o=t(3563),l=t(6781),c=t(8459),d=t(7324),h=t(9246);const u=e=>{const a=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),t=window.atob(a),s=new Uint8Array(t.length);for(let r=0;r<t.length;++r)s[r]=t.charCodeAt(r);return s},g=async e=>{try{(await h.A.post("https://sameer-yadav.online/api/webauthn-verify-registration",{credential:e},{withCredentials:!0})).data.verified?alert("Registration successful!"):alert("Registration failed. Please try again.")}catch(a){console.error("Registration verification error:",a)}};var m=t(4745),p=t(4414);function y(){const{user:e,setUser:a}=(0,s.useContext)(r.R),[t,y]=(0,s.useState)(!1),[f,w]=(0,s.useState)(null);(0,s.useEffect)((()=>{e&&(y(e.isTwoFactorEnabled||!1),w(e.qrCodeImage||null))}),[e]);return(0,p.jsx)(l.default,{children:(0,p.jsx)(c.default,{children:(0,p.jsx)("div",{children:(0,p.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,p.jsxs)(n.A,{sx:{width:"100%"},children:[(0,p.jsxs)(i.Ay,{alignItems:"flex-start",children:[(0,p.jsx)(o.A,{primary:"WebAuthn Registration (for password-less login)"}),(0,p.jsx)(o.A,{secondary:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("button",{style:{marginTop:0},className:"btn",onClick:()=>async function(){try{const e=await(0,h.A)("https://sameer-yadav.online/api/webauthn-register",{withCredentials:!0}),a=u(e.data.challenge),t=u(e.data.user.id),s={...e.data,challenge:a,user:{...e.data.user,id:t}},r=await navigator.credentials.create({publicKey:s});await g(r)}catch(e){console.error("Registration error:",e)}}(),children:"Enable on this device"}),(0,p.jsx)("button",{style:{marginTop:0,marginLeft:"10px"},className:"btn",onClick:()=>async function(){try{const e=await(0,h.A)("https://sameer-yadav.online/api/disable-webauthn",{withCredentials:!0});alert(e.data.message)}catch(e){console.error(e)}}(),children:"Disable"})]})})]}),(0,p.jsx)(m.A,{variant:"fullWidth",component:"li"}),(0,p.jsxs)(i.Ay,{alignItems:"flex-start",children:[(0,p.jsx)(o.A,{primary:"Google Authenticator (2FA)"}),(0,p.jsx)(o.A,{secondary:(0,p.jsx)(d.A,{checked:t,onChange:t=>{t.target.checked?async function(e,a,t,s){try{const r=await(0,h.A)("https://sameer-yadav.online/api/enable-two-factor",{withCredentials:!0});t(r.data.qrCodeImage),a(!0),s({...e,backupCodes:r.data.backupCodes,isTwoFactorEnabled:!0,qrCodeImage:r.data.qrCodeImage})}catch(r){console.error(r)}}(e,y,w,a):async function(e){try{const a=await h.A.delete("https://sameer-yadav.online/api/disable-two-factor",{withCredentials:!0});"Two factor authentication disabled"===a.data.message?e(!1):alert(a.data.message)}catch(a){console.error(a)}}(y)}})})]}),t&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(i.Ay,{alignItems:"flex-start",children:[(0,p.jsx)(o.A,{primary:"Scan the QR code below to enable 2FA using Google Authenticator App"}),(0,p.jsx)(o.A,{})]}),(0,p.jsx)("img",{src:f,alt:"QR code"})]})]})})})})})}const f=s.memo(y)}}]);