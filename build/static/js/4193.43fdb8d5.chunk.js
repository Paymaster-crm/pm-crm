"use strict";(self.webpackChunkpaymaster_crm=self.webpackChunkpaymaster_crm||[]).push([[4193],{4193:(e,a,s)=>{s.r(a),s.d(a,{default:()=>g});var o=s(9950),r=s(9246),t=s(3939),n=s(2436),d=s(9714);const i=(e,a)=>d.Ik({password:a?d.Yj().notRequired():d.Yj().required("Password is required"),twoFAToken:e&&!a?d.Yj().required("2FA token is required"):d.Yj().notRequired(),backupCode:a?d.Yj().required("Backup code is required").length(8,"Backup code must be exactly 8 characters long"):d.Yj().notRequired()});var l=s(4019),c=s(1118),u=s(2986),p=s(3557),h=s(4414);function m(e){const{setUser:a}=(0,o.useContext)(n.R),[s,d]=(0,o.useState)(!1),m=(0,o.useRef)(null),g=(0,t.Wx)({initialValues:{username:e.username,password:"",twoFAToken:"",backupCode:""},validationSchema:i(e.isTwoFactorEnabled,s),onSubmit:async o=>{const t=await(0,u.N)();try{const n=await r.A.post("https://sameer-yadav.online/api/login",{username:o.username,password:o.password,twoFAToken:s?"":o.twoFAToken,backupCode:s?o.backupCode:"",userAgent:navigator.userAgent,geolocation:t,isTwoFactorEnabled:e.isTwoFactorEnabled,useBackupCode:s},{withCredentials:!0});"Login successful"===n.data.message?a(n.data.user):(alert(n.data.message),g.setFieldValue("twoFAToken",""),g.setFieldValue("backupCode",""))}catch(n){console.error(n),alert(n.response.data.message)}}});return(0,o.useEffect)((()=>{var e;null===(e=m.current)||void 0===e||e.focus()}),[]),(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("form",{className:"login-form",onSubmit:g.handleSubmit,children:[!s&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c._,{ref:m,toggleMask:!0,id:"password",name:"password",placeholder:"Password",value:g.values.password,onChange:g.handleChange,feedback:!1,className:g.touched.password&&g.errors.password?"p-invalid":""}),g.touched.password&&g.errors.password&&(0,h.jsx)("small",{className:"p-error",children:g.errors.password})]}),e.isTwoFactorEnabled&&(0,h.jsxs)("div",{children:[s?(0,h.jsx)("span",{children:"Enter Backup Code"}):(0,h.jsx)("span",{children:"Enter Google Authenticator token"}),!s&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(l.o,{placeholder:"Enter 6-digit code",value:g.values.twoFAToken,onChange:e=>g.setFieldValue("twoFAToken",e.value),mask:!0,integerOnly:!0,length:6}),g.touched.twoFAToken&&g.errors.twoFAToken&&(0,h.jsx)("small",{className:"p-error",children:g.errors.twoFAToken})]}),s&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(l.o,{placeholder:"Enter Backup Code",value:g.values.backupCode,onChange:e=>g.setFieldValue("backupCode",e.value),mask:!0,length:8}),g.touched.backupCode&&g.errors.backupCode&&(0,h.jsx)("small",{className:"p-error",children:g.errors.backupCode})]}),(0,h.jsx)("span",{onClick:()=>d(!s),style:{cursor:"pointer",color:"#0060ae",fontWeight:"bold",marginTop:"16px"},children:s?"Use Google Authenticator":"Use Backup Code"})]}),(0,h.jsx)("div",{style:{marginTop:16},children:(0,h.jsx)(p.default,{isSubmitting:g.isSubmitting,name:"Login"})})]})})}const g=o.memo(m)},2986:(e,a,s)=>{s.d(a,{N:()=>o});const o=async()=>{try{const e=await fetch("https://api.ipify.org?format=json"),a=(await e.json()).ip,s=await fetch(`https://ipapi.co/${a}/json/`),o=await s.json();return{latitude:o.latitude,longitude:o.longitude,ipAddress:a}}catch(e){console.error("Error fetching data:",e)}}}}]);